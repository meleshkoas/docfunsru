### В предыдущих сериях

GPT и трансформеры

- Токенизация
- Векторизация
- Блок внимания
- Блок мультиуровневого восприятия
- Девекторизация и вывод

### Векторизация (и токенизация)

```python
from sentence_transformers import SentenceTransformer

model = SentenceTransformer("sentence-transformers/all-MiniLM-L6-v2")
text = "Мама мыла раму"
emb = model.encode(text, normalize_embeddings=True)

print(emb[:8])     # первые числа векторa
```

### Retrieval Augmented Generation (RAG)

Генерация с использованием внешних ресурсов

- Почему не заливать всё сразу?
- Почему не сделать поиск по словам?
- ?

### Векторизация в файл

```python
FILENAME = sys.argv[1] if len(sys.argv) > 1 else "input.md"

with open(FILENAME, "r", encoding="utf-8", errors="ignore") as f:
    text = f.read()

chunks = [c.strip() for c in re.split(r'(?m)^(?=#)', text) if c.strip()]

model = SentenceTransformer("sentence-transformers/all-MiniLM-L6-v2")
embs = model.encode(chunks, normalize_embeddings=True, convert_to_numpy=True)

np.savez("index.npz", embs=embs, texts=np.array(chunks, dtype=object))

print("Готово. Разделов:", len(chunks), "| Файл: index.npz")
```

### Работа с файлом векторов

```python
z = np.load("index.npz", allow_pickle=True)
embs = z["embs"]
texts = z["texts"].tolist()

model = SentenceTransformer("sentence-transformers/all-MiniLM-L6-v2")
text = "Мир"
emb = model.encode(text, normalize_embeddings=True, convert_to_numpy=True)

sims = embs @ emb

topk = sims.argsort()[-3:][::-1]

print("Top-3 совпадений:")
for rank, i in enumerate(topk[:3], 1):
    print(f"{rank}. idx={int(i)}  score={sims[i]:.4f}\n{texts[i]}\n---")
```

### Полезные материалы

Код из презентации

    github.com/meleshkoas/docfunsru/tree/main/slides/11

Пример живого проекта с RAG

    ask.postgrespro.ru

### КТ 11. Генерация с RAG по существующему ТЗ

Задача (0-15 баллов):

- Разбить ТЗ на блоки и векторизовать в файл
  - см. `md_to_vectors.py`
- При отправке запроса к нейронке искать в этом файле вектора, совпадающие с запросом
  - см. `try_example.py` -- отправка запроса
  - см. `vectorize_example_2.py` -- подбор похожих векторов

### КТ 11. Генерация с RAG по существующему ТЗ

Сдать:

- Ссылку на ваш гитхаб, где лежит:
  - Сделанное ранее ТЗ (на игру или на кофе-бот)
  - Код программы, отправляющей запрос с RAG
  - Файл векторов